--- INTERROGATION DE LA BASE DE DONNEES ---

--- Les membres de l’équipe "FOX" ---
SELECT PERSONNE.nom_p, PERSONNE.prenom_p, nom_equipe
FROM PERSONNE NATURAL JOIN AFFECTATION NATURAL JOIN EQUIPE
WHERE nom_equipe LIKE 'FOX';

--- La liste des doctorants qui ont commencé leur thèse cette année (après le 01/09/2021) ---
SELECT nom_p, prenom_p
FROM PERSONNE
WHERE PERSONNE.id_grade IN (
    SELECT id_grade FROM GRADE
    WHERE nom_grade LIKE '%Doctorant%'
)
AND PERSONNE.date_arrive >= '01/09/2021';
        
--- La liste des doctorants encadrés par "Rossi Antoine" ---
SELECT nom_p, prenom_p
FROM PERSONNE
WHERE PERSONNE.nom_directeur LIKE '%Rossi Antoine%';

--- Les noms des employeurs avec le nombre de personnes employés par chacun ---
SELECT EMPLOYEUR.nom_employeur, COUNT(PERSONNE.id_p)
FROM EMPLOYEUR NATURAL JOIN PERSONNE
GROUP BY EMPLOYEUR.nom_employeur;

--- La liste des fonctionnaires appartenant à la section 27 et qui sont arrivés au laboratoire depuis moins d’un an ---
SELECT nom_p, prenom_p, nom_nature_tsupp
FROM PERSONNE NATURAL JOIN SUPPORT NATURAL JOIN TYPE_SUPPORT
WHERE TYPE_SUPPORT.nom_nature_tsupp LIKE 'Fonctionnaire';

--- La liste des personnes qui ont été affectés à plusieurs équipes ---
SELECT nom_p, prenom_p, COUNT(id_equipe) AS "nombre_equipe"
FROM PERSONNE NATURAL JOIN AFFECTATION NATURAL JOIN EQUIPE
GROUP BY nom_p, prenom_p
HAVING COUNT(id_equipe) > 1
ORDER BY COUNT(id_equipe);

--- La liste des personnes qui sont encore au laboratoire ---
SELECT nom_p, prenom_p, 'personne qui sont toujours dans le labo'
FROM PERSONNE NATURAL JOIN AFFECTATION
WHERE fin_affectation = '01/01/0001';

--- La liste des non permanents appartenant à l’équipe "NOCE" et qui ne sont pas doctorants ---
SELECT PERSONNE.nom_p, PERSONNE.prenom_p, EQUIPE.nom_equipe
FROM PERSONNE NATURAL JOIN AFFECTATION NATURAL JOIN EQUIPE
WHERE EQUIPE.nom_equipe LIKE '%NOCE%'
AND PERSONNE.id_categorie = (
    SELECT id_categorie FROM CATEGORIE
    WHERE nom_categorie LIKE '%NON PERMANENT%'
);

--- La liste des personnes de nationalité "chinoise" qui sont doctorant ou en CDD ---
SELECT PERSONNE.nom_p, PERSONNE.prenom_p, PAYS.nom_pays
FROM PERSONNE NATURAL JOIN PAYS
WHERE PAYS.nom_pays LIKE '%Chine%'
AND PERSONNE.id_grade IN (
    SELECT id_grade FROM GRADE
    WHERE nom_grade LIKE '%Doctorant%'
)
AND PERSONNE.id_p IN (
    SELECT SUPPORT.id_p FROM SUPPORT NATURAL JOIN TYPE_SUPPORT
    WHERE TYPE_SUPPORT.nom_nature_tsupp LIKE '%CDD%'
);

--- La liste des non permanents employés par le CNRS qui ont plus de 50 ans et qui sont arrivés au laboratoire en 2021 ---
SELECT PERSONNE.nom_p, PERSONNE.prenom_p, PERSONNE.date_n
FROM PERSONNE
WHERE PERSONNE.id_categorie = (
    SELECT id_categorie
    FROM CATEGORIE
    WHERE nom_categorie LIKE '%NON PERMANENT%'
)
AND PERSONNE.date_n < '01/01/1972'
AND PERSONNE.id_employeur = (
    SELECT id_employeur
    FROM EMPLOYEUR
    WHERE nom_employeur LIKE 'CNRS'
)
AND EXTRACT(YEAR FROM date_arrive) = 2021;
    
--- Le pays qui compte le plus grand nombre de doctorants (requete non-fonctionnelle, mais la réponse est : France) --
SELECT nom_pays
FROM PERSONNE NATURAL JOIN PAYS NATURAL JOIN GRADE
WHERE nom_grade >(SElECT MAX(nom_grade )
FROM GRADE
WHERE nom_grade LIKE '%Doctorant%');
